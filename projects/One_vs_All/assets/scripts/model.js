'use strict';

function Model() {
  let myView = null,
      self = this;

  self.init = function (view) {
    myView = view;
    self.settings = {
      links: {
        main: `
        <div id="main" class="d-flex flex-column justify-content-center align-items-center">
            <h1>One vs All</h1>
            <div class="d-flex flex-column justify-content-center align-items-center">
                <a href="#game">Survival Game</a>
                <a href="#levelGame">Level Game</a>
                <a href="#rules">Rules</a>
                <a href="#results">Results</a>
            </div>
            
          </div>
        `,
        game: `
        <div id="game">
          <ul class="nav justify-content-center">
            <li class="nav-item">
              <a class="nav-link active" href="#main">Main page</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#rules">Rules</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#results">Results</a>
            </li>
          </ul>
          <div id="score"></div>
          <div id="wrapper"><canvas id="canvas"></canvas></div>
          <button id="start" class="btn btn-warning">start</button>
          <button id="pause" class="btn btn-warning">pause</button>
          <button id="resume" class="btn btn-warning">resume</button>
          <div id="modal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-body">
                <p>Enter your name to save your score</p>
                  <input id="playerName"></input>
                </div>
                <div class="modal-footer">
                  <button id="close" type="button" class="btn btn-secondary" data-dismiss="modal">cancel</button>
                  <button id="save" type="button" class="btn btn-warning">save</button>
                </div>  
              </div>
            </div>
          </div>
        </div>
        `,
        levelGame : `
          <div id="levelGame">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div class="levels">
                <a id="level level1" href="#level1">1</a>
                <a id="level level2" href="#level2">2</a>
                <a id="level level3" href="#level3">3</a>
                <a id="level level4" href="#level4">4</a>
                <a id="level level5" href="#level5">5</a>
                <a id="level level6" href="#level6">6</a>
            </div>
          </div>
        `,
        level1 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        level2 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        level3 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        level4 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        level5 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        level6 : `
          <div id="levels">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="#main">Main</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#rules">Rules</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#results">Results</a>
                </li>
            </ul>
            <div id="score"></div>
            <div id="wrapper"><canvas id="canvas"></canvas></div>
            <button id="start-lvl" class="btn btn-warning">start</button>
          </div>
        `,
        rules: `
        <div id="rules">
          <ul class="nav justify-content-center">
            <li class="nav-item">
              <a class="nav-link active" href="#main">Main page</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#game">Play</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#results">Reults</a>
            </li>
          </ul>
          <div class="h-100 d-flex align-items-center justify-content-center">
            <p><strong>Survival Game:</strong>
            <br>The controls are arrow keys and the letters AWDS, the shot is carried out by clicking the left mouse button. 
            <br> The game is about survival: the more enemies you shoot, the higher you will be in the score table. 
            <br> One kill one point.
            <br><strong>Level Game:</strong>
            <br>Ð¡ontrol and shooting are the same as in the Survival Game, but you have missions.
            <br><strong>Level 1 - kill 10 enemies</strong>
            <br><strong>Level 2 - kill 20 enemies</strong>
            <br><strong>Level 3 - kill 30 enemies</strong>
            <br><strong>Level 4 - kill 50 enemies</strong>
            <br><strong>Level 5 - kill 70 enemies</strong>
            <br><strong>Level 6 - kill 100 enemies</strong>
            </p>
          </div>
        </div>
        `,
        results: `
        <div id="results">
          <ul class="nav justify-content-center">
            <li class="nav-item">
              <a class="nav-link active" href="#main">Main page</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#game">Play</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#rules">Rules</a>
            </li>
          </ul>
          <div id="scoreTable"></div>
        </div>
        `
      },
      canvasWidth: null,
      canvasHeight: null,
      board: null,
      hero: null,
      fireball: null,
      enemies: [],
      boardImg: './assets/img/board.jpg',
      enemyImg: './assets/img/characters/enemy.png',
      bossImg: './assets/img/characters/boss.png',
      heroImg: './assets/img/characters/hero.png',
      fireballImg: './assets/img/fireball.png',
      fireballSound: './assets/audio/fireball.wav',
      enemyDieSound: './assets/audio/enemiesDie.mp3',
      enemyMoveSound: './assets/audio/enemiesMove.mp3',
      heroDieSound: 'sounds/heroDie.mp3',
      score: 0,
      playerScore: null,
      resultData: [],
      enemiesTimer: null,
      gameTimer: null,
      paused: null,
      gameOver: null,
    };
  };

  // Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑÐ¾ÑÐ½Ð¸Ñ
  self.updateState = function() {
    // ÑÐ°Ð·Ð¼ÐµÑ Ð¾ÐºÐ½Ð°
    self.resize();
    // Ð½Ð° ÐºÐ°ÐºÐ¾Ð¹ ÑÑÑÐ°Ð½Ð¸ÑÐµ Ð±ÑÐ´Ñ Ð½Ð°ÑÐ¾Ð´Ð¸ÑÑÑ Ð¿ÐµÑÐ²Ð¾Ð½Ð°ÑÐ°Ð»ÑÐ½Ð¾
    let content = self.settings.links[window.location.hash.slice(1)];
    myView.updateState(content, self.settings.links, self.settings.canvasWidth, self.settings.canvasHeight);
    // Ð·Ð°Ð´Ð°Ñ ÑÑÐ»Ð¾Ð²Ð¸Ñ Ð´Ð»Ñ ÑÑÑÐ°Ð½Ð¸ÑÑ Ñ Ð¸Ð³ÑÐ¾Ð¹
    if (content === self.settings.links.game) {
      //ÐµÑÐ»Ð¸ Ð¸Ð½ÑÐ° Ð½Ðµ Ð½Ð° Ð¿Ð°ÑÐ·Ðµ Ð¸ Ð½Ðµ Ð¿ÑÐ¾Ð¹Ð³ÑÐ°Ð½Ð°
      if (!self.settings.gameOver && !self.settings.paused) {
        // ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð°ÑÐ·Ñ Ð¸ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ
        myView.hidePauseButton();
        myView.hideResumeButton();
        // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð²
        self.gameInit();
        // ÑÑÐµÑ ÑÐ°Ð²ÐµÐ½ 0
        self.settings.score = 0;
        myView.updateScore(self.settings.score);
      }
      // ÐµÑÐ»Ð¸ Ð¸Ð³ÑÐ° Ð½Ð° Ð¿Ð°ÑÐ·Ðµ, Ð½Ð¾ Ð½Ðµ Ð¿ÑÐ¾Ð¹Ð³ÑÐ°Ð½Ð° ÑÐ¾
      if (self.settings.paused && !self.settings.gameOver) {
        // ÐµÑÐ»Ð¸ ÑÐ°Ð¹Ð¼ÐµÑ ÑÐ°Ð²ÐµÐ½ null (Ð¿Ð¾ÑÐ»Ðµ Ð½Ð°Ð¶Ð°ÑÐ¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑ Ð¿Ð°ÑÐ·Ð°)
        if (self.settings.gameTimer) {
          // ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ Ð¿Ð°ÑÐ·Ñ Ð¸ ÑÑÐ°ÑÑÐ°, Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ
          myView.hidePauseButton();
          myView.showResumeButton();
          myView.hideStartButton();
        } else {
          //ÐµÑÐ»Ð¸ Ð½Ð°Ð¾Ð±Ð¾ÑÐ¾Ñ, ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð°ÑÐ·Ñ Ð¸ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ, Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑÐ°
          myView.hidePauseButton();
          myView.showStartButton();
          myView.hideResumeButton()
        }
        // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð², Ð¾Ð±Ð½Ð¾Ð²Ð¸ÑÑ ÑÑÐµÑ
        self.gameInit();
        myView.updateScore(self.settings.score);
      }
      // ÐµÑÐ»Ð¸ Ð¿ÑÐ¾Ð¸Ð³ÑÐ°Ð»Ð¸
      if (self.settings.gameOver) {
        // ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð°ÑÐ·Ñ Ð¸ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ, Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑ
        myView.hidePauseButton();
        myView.hideResumeButton();
        myView.showStartButton();
        //ÑÑÐµÑ ÑÐ°Ð²ÐµÐ½ 0, Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð², Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸ÑÑ ÑÑÐµÑ
        self.settings.score = 0;
        self.gameInit();
        myView.updateScore(self.settings.score);
      }
    }
    // ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð²ÑÑÐµÐ» ÑÐ¾ ÑÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð³ÑÑ
    if (content !== self.settings.links.game) {
      // ÑÐ¾ Ð¿Ð¾ÑÑÐ°Ð²Ð¸ÑÑ Ð¸Ð³ÑÑ Ð½Ð° Ð¿Ð°ÑÐ·Ñ Ð¸ ÑÐ¾ÑÑÐ°Ð½Ð¸ÑÑ Ð²ÑÐµÑ Ð½Ð° ÑÐ²Ð¾Ð¸Ñ Ð¼ÐµÑÑÐ°Ñ
      self.settings.paused = true;
      cancelAnimationFrame(self.settings.gameTimer);
      cancelAnimationFrame(self.settings.enemies);
      clearInterval(self.settings.enemiesTimer);
    }
    //////////////////////////////////////////////////////////////////////////////LEVELS/////////////////////////////////////////////////////
    if (content === self.settings.links.levelGame) {
      alert('We regret. Level tasks are on the rules page');
    }
    if (content === self.settings.links.level1 ||
        content === self.settings.links.level2 ||
        content === self.settings.links.level3 ||
        content === self.settings.links.level4 ||
        content === self.settings.links.level5 ||
        content === self.settings.links.level6
    ) {

      //ÐµÑÐ»Ð¸ Ð¸Ð½ÑÐ° Ð½Ðµ Ð½Ð° Ð¿Ð°ÑÐ·Ðµ Ð¸ Ð½Ðµ Ð¿ÑÐ¾Ð¹Ð³ÑÐ°Ð½Ð°
      if (!self.settings.gameOver) {
        // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð²
        self.levelGameInit();
        // ÑÑÐµÑ ÑÐ°Ð²ÐµÐ½ 0
        self.settings.score = 0;
        myView.updateScore(self.settings.score);
        if (self.settings.gameTimer) {
          // ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ Ð¿Ð°ÑÐ·Ñ Ð¸ ÑÑÐ°ÑÑÐ°, Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ
          myView.hideLevelStartButton();
        } else {
          //ÐµÑÐ»Ð¸ Ð½Ð°Ð¾Ð±Ð¾ÑÐ¾Ñ, ÑÐ¾ ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ð°ÑÐ·Ñ Ð¸ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ, Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑÐ°
          myView.showLevelStartButton();
        }
        // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð², Ð¾Ð±Ð½Ð¾Ð²Ð¸ÑÑ ÑÑÐµÑ
        self.levelGameInit();
        myView.updateScore(self.settings.score);
      }
      // ÐµÑÐ»Ð¸ Ð¿ÑÐ¾Ð¸Ð³ÑÐ°Ð»Ð¸
      if (self.settings.gameOver) {
        //Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑ
        myView.showLevelStartButton();
        //ÑÑÐµÑ ÑÐ°Ð²ÐµÐ½ 0, Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ, Ð³ÐµÑÐ¾Ñ Ð¸ Ð²ÑÐ°Ð³Ð¾Ð², Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸ÑÑ ÑÑÐµÑ
        self.settings.score = 0;
        self.levelGameInit();
        myView.updateScore(self.settings.score);
      }
    }
    if (content !== self.settings.links.level1 ||
        content !== self.settings.links.level2 ||
        content !== self.settings.links.level3 ||
        content !== self.settings.links.level4 ||
        content !== self.settings.links.level5 ||
        content !== self.settings.links.level6
    ) {
      // ÑÐ¾ Ð¿Ð¾ÑÑÐ°Ð²Ð¸ÑÑ Ð¸Ð³ÑÑ Ð½Ð° Ð¿Ð°ÑÐ·Ñ Ð¸ ÑÐ¾ÑÑÐ°Ð½Ð¸ÑÑ Ð²ÑÐµÑ Ð½Ð° ÑÐ²Ð¾Ð¸Ñ Ð¼ÐµÑÑÐ°Ñ
      self.settings.paused = false;
      cancelAnimationFrame(self.settings.gameTimer);
      cancelAnimationFrame(self.settings.enemies);
      clearInterval(self.settings.enemiesTimer);
    }
    // ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð½Ð°ÑÐ¾Ð´Ð¸ÑÑÑ Ð½Ð° ÑÑÑÐ°Ð½Ð¸ÑÐµ Ñ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ¾Ð¼, ÑÐ¾ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ ÐµÐ³Ð¾
    if (content === self.settings.links.results) {
      self.getResult();
    }
  };

  // Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ Ð¸Ð³ÑÑ
  self.gameInit = function() {
    // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð¿Ð¾Ð»Ñ, ÑÐ¾ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ»Ð²Ð°ÑÑ
    if (!self.settings.board) {
      self.createBoard();
    } else {
      self.drawBoard();
    }
    // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð³ÐµÑÐ¾Ñ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
    if (!self.settings.hero) {
      self.createHero();
    } else {
      self.drawHero();
    }
    //ÐµÑÐ»Ð¸ ÐµÑÑÑ Ð³ÐµÑÐ¾Ð¸ ÑÐ¾ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
    if (self.settings.enemies) {
      myView.drawEnemies(self.settings.enemies)
    }
    //Ð·Ð°ÐºÑÑÑÑ Ð¼Ð¾Ð´Ð°Ð»ÐºÑ Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð²ÑÑ
    myView.closeModal();
    myView.draw();
  };
  //////////LEVEL GAME INIT///////////////////////
  self.levelGameInit = function() {
    // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð¿Ð¾Ð»Ñ, ÑÐ¾ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ»Ð²Ð°ÑÑ
    if (!self.settings.board) {
      self.createBoard();
    } else {
      self.drawBoard();
    }
    // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð³ÐµÑÐ¾Ñ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
    if (!self.settings.hero) {
      self.createHero();
    } else {
      self.drawHero();
    }
    //ÐµÑÐ»Ð¸ ÐµÑÑÑ Ð³ÐµÑÐ¾Ð¸ ÑÐ¾ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
    if (self.settings.enemies) {
      myView.drawEnemies(self.settings.enemies)
    }
    //Ð·Ð°ÐºÑÑÑÑ Ð¼Ð¾Ð´Ð°Ð»ÐºÑ Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð²ÑÑ
    myView.draw();
  };

  // ÑÐ¸ÐºÐ» Ð¸Ð³ÑÑ, Ð¿ÑÐ¾Ð²ÐµÑÐ¸ÑÑ Ð½Ð° Ð¿Ð¾ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ, Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ, Ð¸Ð·Ð¾Ð±ÑÐ°Ð¶Ð°Ñ Ð°Ð½Ð¸Ð¼Ð°ÑÐ¸Ñ
  self.game = function() {
    self.checkMissions();
    self.checkGameOver();
    self.update();
    self.settings.gameTimer = requestAnimationFrame(self.game);
  };

  /////////////////////////////////////////////////////LEVELS///////////////////////////////////////////////////////////
  self.checkMissions = function() {
    if (self.settings.links.level1) {
      if (self.settings.score === 10) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
    if (self.settings.links.level2) {
      if (self.settings.score === 20) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
    if (self.settings.links.level3) {
      if (self.settings.score === 30) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
    if (self.settings.links.level4) {
      if (self.settings.score === 50) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
    if (self.settings.links.level5) {
      if (self.settings.score === 70) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
    if (self.settings.links.level6) {
      if (self.settings.score === 100) {
        myView.draw();
        console.log('score' + self.settings.score);
        self.settings.hero = null;
        self.settings.fireball = null;
        cancelAnimationFrame(self.settings.gameTimer);
        clearInterval(self.settings.enemiesTimer);
      }
    }
  };

  // Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð³ÑÑ
  self.update = function () {
    // ÐµÑÐ»Ð¸ Ð¸Ð³ÑÐ° Ð¿ÑÐ¾Ð¸Ð³ÑÐ°Ð½Ð° Ð¸ Ð½Ðµ Ð½Ð° Ð¿Ð°ÑÐ·Ðµ
    if (!self.settings.gameOver && !self.settings.paused) {
      // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð¿Ð¾Ð»Ñ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð½Ð°ÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
      if (!self.settings.board) {
        self.createBoard();
      } else {
        self.drawBoard();
      }
      // Ð·Ð°Ð¿ÑÑÑÐ¸ÑÑ Ð²ÑÐ°Ð³Ð¾Ð²
      self.moveEnemies();
      // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð³ÐµÑÐ¾Ñ
      self.drawHero();
      // Ð¾ÑÐ¾Ð±ÑÐ°Ð¶Ð°ÑÑ Ð¿ÑÐ»ÑÐºÑ
      if (self.settings.fireball) {
        self.moveFireball();
      }
      // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¸Ð³ÑÑ
      myView.draw();
      //ÐµÑÐ»Ð¸ Ð¸Ð³ÑÐ° Ð¿ÑÐ¾Ð¸Ð³ÑÐ°Ð½Ð°
    } else if (self.settings.gameOver) {
      // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ ÐºÐ°Ð½Ð²Ð°Ñ
      myView.draw();
      // Ð³ÐµÑÐ¾Ñ Ð¸ Ð¿ÑÐ»ÑÐºÑ ÑÐ±ÑÐ°ÑÑ
      self.settings.hero = null;
      self.settings.fireball = null;
      // ÐµÑÐ»Ð¸ Ð¸Ð³ÑÐ° Ð½Ð° Ð¿Ð°ÑÐ·Ðµ
    } else if (self.settings.paused) {
      // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð¿Ð¾Ð»Ñ ÑÐ¾ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð°Ð²ÑÑ
      if (!self.settings.board) {
        self.createBoard();
      } else {
        self.drawBoard();
      }
      // ÐµÑÐ»Ð¸ Ð½ÐµÑ Ð³ÐµÑÐ¾Ñ ÑÐ¾ ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¸Ð»Ð¸ Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ
      if (!self.settings.hero) {
        self.createHero();
      } else {
        self.drawHero();
      }
      // Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð²ÑÑ
      myView.draw();
    }
  };

  // Ð½Ð°ÑÐ°Ð»Ð¾ Ð¸Ð³ÑÑ
  self.startGame = function() {
    // Ð¸Ð³ÑÐ° Ð½Ðµ Ð¿ÑÐ¾Ð¹Ð³ÑÐ°Ð½Ð° Ð¸ Ð½Ðµ Ð½Ð° Ð¿Ð°ÑÐ·Ðµ
    self.settings.paused = false;
    self.settings.gameOver = false;
    // Ð¿ÑÐ¾Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ Ð¸Ð³ÑÑ, ÑÐ¸ÐºÐ» Ð¸Ð³ÑÑ
    self.gameInit();
    self.game();
    // ÑÐ¾Ð·Ð´Ð°Ð²Ð°ÑÑ Ð²ÑÐ³Ð¾Ð² ÐºÐ°Ð¶Ð´ÑÑ ÑÐµÐºÑÐ½Ð´Ñ
    self.settings.enemiesTimer = setInterval(self.createEnemies, 1000);
    // ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ Ð¿Ð°ÑÐ·Ñ
    myView.hideStartButton();
    myView.showPauseButton();
  };

  self.levelStartGame = function() {
    // Ð¸Ð³ÑÐ° Ð½Ðµ Ð¿ÑÐ¾Ð¹Ð³ÑÐ°Ð½Ð° Ð¸ Ð½Ðµ Ð½Ð° Ð¿Ð°ÑÐ·Ðµ
    self.settings.paused = false;
    self.settings.gameOver = false;
    // Ð¿ÑÐ¾Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ Ð¸Ð³ÑÑ, ÑÐ¸ÐºÐ» Ð¸Ð³ÑÑ
    self.levelGameInit();
    self.game();
    // ÑÐ¾Ð·Ð´Ð°Ð²Ð°ÑÑ Ð²ÑÐ³Ð¾Ð² ÐºÐ°Ð¶Ð´ÑÑ ÑÐµÐºÑÐ½Ð´Ñ
    self.settings.enemiesTimer = setInterval(self.createLevelEnemies, 1000);
    // ÑÐ¿ÑÑÑÐ°ÑÑ ÐºÐ½Ð¾Ð¿ÐºÑ ÑÑÐ°ÑÑ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ Ð¿Ð°ÑÐ·Ñ
    myView.hideLevelStartButton();
  };

  // Ð¿Ð°ÑÐ·Ð°
  self.pauseGame = function() {
    self.settings.paused = true;
    //Ð¾ÑÑÐ°Ð½Ð¾Ð²Ð¸ÑÑ Ð²ÑÐ°Ð³Ð¾Ð² Ð¸ Ð¾ÑÐ¼ÐµÐ½Ð¸ÑÑ Ð°Ð½Ð¸Ð¼Ð°ÑÐ¸Ñ
    clearInterval(self.settings.enemiesTimer);
    cancelAnimationFrame(self.settings.gameTimer);
    myView.hidePauseButton();
    myView.showResumeButton();
  };

  // Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ
  self.gameReturn = function() {
    self.settings.paused = false;
    self.settings.gaming = true;
    // Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ ÑÐ¾Ð·Ð´Ð°Ð²Ð°ÑÑ Ð²ÑÐ°Ð³Ð¾Ð² Ð¸ Ð²ÐºÐ»ÑÑÐ¸ÑÑ Ð°Ð½Ð¸Ð¼Ð°ÑÐ¸Ñ
    self.settings.enemiesTimer = setInterval(self.createEnemies, 1000);
    self.settings.gameTimer = requestAnimationFrame(self.game);
    myView.hideResumeButton();
    myView.showPauseButton();
  };

  // Ð¿ÑÐ¾Ð¸Ð³ÑÑÑ
  self.gameOver = function () {
    self.settings.gameOver = true;
    self.settings.playerScore = self.settings.score;
    // Ð¿Ð¾ÐºÐ°Ð·Ð°ÑÑ Ð¼Ð¾Ð´Ð°Ð»ÑÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾
    myView.showModal();
    self.checkGameOver();
  };

  // Ð¿ÑÐ¾Ð²ÐµÑÐºÐ° Ð½Ð° Ð¿Ð¾ÑÐ°Ð¶ÐµÐ½Ð¸Ðµ
  self.checkGameOver = function() {
    // Ð¾ÑÑÐ°Ð½Ð¾Ð²Ð¸ÑÑ Ð°Ð½Ð¸Ð¼Ð°ÑÐ¸Ñ
    cancelAnimationFrame(self.settings.gameTimer);
    if (self.settings.gameOver) {
      self.settings.enemies = [];
      self.settings.score = 0;
      myView.updateScore(self.settings.score);
      clearInterval(self.settings.enemiesTimer);
      myView.hidePauseButton();
      myView.showStartButton();
    }
  };

  // ÑÑÐ¾Ð»ÐºÐ½Ð¾Ð²ÐµÐ½Ð¸Ñ
  self.collisions = function(obj1, obj2) {
    // Ð²Ð¾Ð·ÑÐ°ÑÐ°ÐµÑ true || false
    return !!(obj1.posX + obj1.width / 2 >= obj2.posX && obj1.posX + obj1.width / 2 <= obj2.posX + obj2.width && obj1.posY + obj1.height / 2 >= obj2.posY && obj1.posY + obj1.height / 2 <= obj2.posY + obj2.height);
  };

  // Ð¿Ð¾Ð»ÑÑÐ°Ñ ÑÐ°Ð½Ð´Ð¾Ð¼Ð½Ð¾Ðµ ÑÐ¸ÑÐ»Ð¾
  self.getRandom = function(min, max) {
    return Math.floor(Math.random() * (max + 1 - min)) + min;
  };

  // ÑÐ¾Ð·Ð´Ð°Ñ Ð¿Ð¾Ð»Ðµ
  self.createBoard = function() {
    let settings = self.settings;
    settings.board = new Image();
    settings.board.src = settings.boardImg;
    // Ð¿ÑÐ¸ Ð·Ð°Ð³ÑÑÐ·ÐºÐµ => update
    settings.board.onload = function() {
      self.update()
    }
  };

  //Ð½Ð°ÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿Ð¾Ð»Ðµ
  self.drawBoard = function() {
    myView.drawBoard(self.settings.board);
  };

  // ÑÐ¾Ð·Ð´Ð°ÑÑ Ð²ÑÐ°Ð³Ð¾Ð²
  self.createEnemies = function() {
    let enemies = self.settings.enemies;
    enemies.push(new Enemy(self.settings.enemyImg));

    let audio = new Audio();
    audio.src = self.settings.enemyMoveSound;
    audio.play();
    for (let i = 0; i < enemies.length; i ++) {
      enemies[i].updateSprite();
    }
  };

    self.createLevelEnemies = function() {
        let enemies = self.settings.enemies;
        enemies.push(new Boss(self.settings.bossImg));

        let audio = new Audio();
        audio.src = self.settings.enemyMoveSound;
        audio.play();
        for (let i = 0; i < enemies.length; i ++) {
            enemies[i].updateSprite();
        }
    };

  //ÑÐ¾Ð·Ð´Ð°ÑÑ Ð³ÐµÑÐ¾Ñ
  self.createHero = function() {
    self.settings.hero = new Hero(self.settings.heroImg);
    self.drawHero();
  };

  // Ð½Ð°ÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð³ÐµÑÐ¾Ñ
  self.drawHero = function() {
    self.checkBounds();
    self.settings.hero.updateSprite();
    myView.drawHero(self.settings.hero);
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð³ÐµÑÐ¾Ñ
  self.moveHero = function(keycode) {
    if (!self.settings.gameOver && !self.settings.paused) {
      if (keycode == 37 || keycode == 65) {
        self.moveLeft();
      }
      if (keycode == 38 || keycode == 87) {
        self.moveTop();
      }
      if (keycode == 39 || keycode == 68) {
        self.moveRight();
      }
      if (keycode == 40 || keycode == 83) {
        self.moveBottom();
      }
    }
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð²Ð»ÐµÐ²Ð¾
  self.moveLeft = function() {
    let hero = self.settings.hero;
    hero.sprite = hero.spriteLeft;
    hero.moveLeft();
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð²Ð¿ÑÐ°Ð²Ð¾
  self.moveRight = function() {
    let hero = self.settings.hero;
    hero.sprite = hero.spriteRight;
    hero.moveRight();
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð²Ð²ÐµÑÑ
  self.moveTop = function() {
    let hero = self.settings.hero;
    hero.sprite = hero.spriteUp;
    hero.moveTop();
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð²Ð½Ð¸Ð·
  self.moveBottom = function() {
    let hero = self.settings.hero;
    hero.sprite = hero.spriteDefault;
    hero.moveBottom();
  };

  //Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð³ÐµÑÐ¾ÐµÐ²
  self.moveEnemies = function() {
    let enemies = self.settings.enemies,
        hero = self.settings.hero;
    if (enemies) {
      for (let i = 0; i < enemies.length; i++) {
        let x0 = enemies[i].posX,
            y0 = enemies[i].posY,
            x1 = hero.posX,
            y1 = hero.posY,
            speed = self.settings.score / 1000 + enemies[i].speed,
            way = Math.sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0));
        enemies[i].posX += (x1 - x0) * speed / way;
        enemies[i].posY += (y1 - y0) * speed / way;
        enemies[i].updateSprite();
        if (self.collisions(enemies[i], hero)) {
          let audio = new Audio();
          audio.src = self.settings.heroDieSound;
          audio.play();
          self.gameOver();
        }
      }
    }
    myView.drawEnemies(enemies);
  };

  // Ð¿ÑÐ¾Ð²ÐµÑÐºÐ° Ð½Ð° Ð²ÑÑÐ¾Ð´ Ð·Ð° Ð¿ÑÐµÐ´ÐµÐ»Ñ ÐºÐ°Ð½Ð²Ð°ÑÐ°
  self.checkBounds = function() {
    let hero = self.settings.hero,
        width = self.settings.canvasWidth,
        height = self.settings.canvasHeight;

    if (hero.posX + hero.width > width) {
      hero.posX = width - hero.width;
    }
    if (hero.posX < 0) {
      hero.posX = 0;
    }
    if (hero.posY < 0) {
      hero.posY = 0;
    }
    if (hero.posY + hero.height > height) {
      hero.posY = height - hero.height;
    }
  };

  //ÑÐ¾Ð·Ð´Ð°ÑÑ Ð¿ÑÐ»ÑÐºÑ
  self.createFireball = function() {
    if (!self.settings.fireball && self.settings.gameTimer) {
      let audio = new Audio();
      audio.src = self.settings.fireballSound;
      audio.play();
      self.settings.fireball = new Fireball(self.settings.fireballImg);
      let fireball = self.settings.fireball,
          hero = self.settings.hero;
      fireball.posX = hero.posX + fireball.width / 3.5;
      fireball.posY = hero.posY + fireball.height / 5;
      fireball.finishPosX = (event.clientX - event.target.getBoundingClientRect().x) - fireball.width / 2;
      fireball.finishPosY = (event.clientY - event.target.getBoundingClientRect().y) - fireball.height / 2;
    }
  };

  // Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¿ÑÐ»ÑÐºÐ¸
  self.moveFireball = function() {
    let fireball = self.settings.fireball,
        width = self.settings.canvasWidth,
        height = self.settings.canvasHeight;
    if (self.settings.fireball) {
      if (fireball.posX + fireball.width > width || fireball.posX < 0 || fireball.posY + fireball.height > height || fireball.posY < 0) {  // Ð¿ÑÐ¸ Ð²ÑÐ»ÐµÑÐµ Ð·Ð° Ð¿ÑÐµÐ´ÐµÐ»Ñ ÐºÐ°Ð½Ð²Ð°ÑÐ° - ÑÐ´Ð°Ð»ÑÐµÐ¼
        self.settings.fireball = null;
      } else {
        let x0 = fireball.startPosX,
            y0 = fireball.startPosY,
            x1 = fireball.finishPosX,
            y1 = fireball.finishPosY,
            speed = fireball.speed,
            way = Math.sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0));
        fireball.posX += (x1 - x0) * speed / way;
        fireball.posY += (y1 - y0) * speed / way;
        if (self.killEnemies()) {
          self.settings.fireball = null;
          self.updateScore();
        } else {
          self.drawFireball();
        }
      }
    }
  };

  // Ð½Ð°ÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð¿ÑÐ»ÑÐºÑ
  self.drawFireball = function() {
    self.settings.fireball.updateSprite();
    myView.drawFireball(self.settings.fireball);
  };

  //ÑÐ±Ð¸ÑÑ Ð²ÑÐ°Ð³Ð¾Ð²
  self.killEnemies = function() {
    for (let i = 0; i < self.settings.enemies.length; i++) {
      if (self.collisions(self.settings.fireball, self.settings.enemies[i])) {
        let audio = new Audio();
        audio.src = self.settings.enemyDieSound;
        audio.play();
        return self.settings.enemies.splice(i, 1);
      }
    }
  };

  // Ð¾Ð±Ð½Ð¾Ð²Ð¸ÑÑ ÑÑÐµÑ
  self.updateScore = function() {
    self.settings.score += 1;
    myView.updateScore(self.settings.score);
  };

  // Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÐ°Ð·Ð¼ÐµÑÐ¾Ð² Ð¾ÐºÐ½Ð°
  self.resize = function() {
    //window.innerWidth/innerHeight ÑÑÐ°Ð½ÑÑ ÑÐµÐºÑÑÐ¸Ð¹ ÑÐ°Ð·Ð¼ÐµÑ Ð¾ÐºÐ½Ð° Ð±ÑÐ°ÑÐ·ÐµÑÐ°
    self.settings.canvasWidth = window.innerWidth * 0.8;
    self.settings.canvasHeight = window.innerHeight * 0.7;
    let hero = self.settings.hero,
        enemies = self.settings.enemies,
        fireball = self.settings.fireball;
    if (hero) {
      hero.width = self.settings.canvasWidth / 23;
      hero.height = self.settings.canvasHeight / 17;
      for (let i = 0; i < enemies.length; i++) {
        enemies[i].width = self.settings.canvasWidth / 30;
        enemies[i].height = self.settings.canvasHeight / 20;
      }
    }
    if (fireball) {
      fireball.width = self.settings.canvasWidth / 39;
      fireball.height = self.settings.canvasWidth / 39;
    }
  };

  // Ð¿ÑÐ¾Ð²ÐµÑÐºÐ° Ð¸Ð½Ð¿ÑÑÐ°, ÐµÑÐ»Ð¸ Ð¸Ð¼Ñ Ð±Ð¾Ð»ÑÑÐµ Ð´Ð²ÑÑ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð², ÑÐ¾ ÑÐ°Ð·ÑÐµÑÑÑ ÑÐ¾ÑÑÐ°Ð½Ð¸ÑÑ
  self.checkValue = function(input) {
    if (input.value && input.value.length >= 2) {
      myView.activateButton();
    } else {
      myView.deactivateButton();
    }
  };

  // ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÑ
  self.saveData = function(input) {
    let userInfo = {
      username : input.value,
      userScore : self.settings.playerScore,
    };
    let userStr = JSON.stringify(userInfo);
    localStorage.setItem('user', userStr);
    let name = input.value,
        score = self.settings.playerScore;
    myAppDB.collection('results').doc(`${name.replace(/\s/g, "_")}`).set({
      player: `${name}`,
      score: `${score}`,
    })
    .then(function() {
      console.log('result saved');
     })
     .catch(function(error) {
      console.log('Ð¾ÑÐ¸Ð±ÐºÐ° ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ°: ', error);
    });
    myView.clearInput(input);
    myView.closeModal();
  };

  // Ð¿Ð¾Ð»ÑÑÐ°ÐµÐ¼ ÑÐµÐ·ÑÐ»ÑÑÐ°Ñ Ð¸Ð· firestore
  self.getResult = function() {
    self.settings.resultData = [];
    myAppDB.collection('results').get()
        .then(function(querySnapshot) {
          querySnapshot.forEach(function(doc) {
            self.settings.resultData.push(doc.data());
            console.log(`${doc.id} => ${doc.data().player} \(${doc.data().score}\)`);
          });
          self.sortD();
          self.printResult();
        });
  };

  // ÑÐ¾ÑÑÐ¸ÑÑÐµÐ¼ Ð´Ð°Ð½Ð½ÑÐµ Ð² Ð¿Ð¾ÑÑÐ´ÐºÐµ ÑÐ±ÑÐ²Ð°Ð½Ð¸Ñ Ð½Ð°Ð±ÑÐ°Ð½Ð½ÑÑ Ð¾ÑÐºÐ¾Ð²
  self.sortD = function() {
    let result = self.settings.resultData;
    result.sort(function(a, b) {
      return b.score - a.score;
    })
  };

  // ÑÐ°ÑÐ¿ÐµÑÐ°ÑÑÐ²Ð°ÐµÐ¼ ÑÐµÐ·ÑÐ»ÑÑÐ°Ñ
  self.printResult = function() {
    if (self.settings.resultData.length < 10) {
      for (let i = 0; i < self.settings.resultData.length; i ++) {
        myView.printResult(self.settings.resultData[i]);
      }
    } else {
      for (let i = 0; i < 10; i ++) {
        myView.printResult(self.settings.resultData[i]);
      }
    }
  };

  // Ð·Ð°ÐºÑÑÐ²Ð°ÐµÐ¼ Ð¼Ð¾Ð´Ð°Ð»ÐºÑ
  self.closeModal = function() {
    myView.closeModal();
  };

  ////////////////////// ÐÐ»Ð°ÑÑÑ //////////////////////

  function Enemy(url) {
    switch (self.getRandom(1, 4)) {

      case 1:  // left
        this.posX = 0;
        this.posY = self.settings.canvasHeight * Math.random();
        break;
      case 2:  // top
        this.posX = Math.random() * self.settings.canvasWidth;
        this.posY = 0;
        break;
      case 3:  // bottom
        this.posX = Math.random() * self.settings.canvasWidth;
        this.posY = self.settings.canvasHeight - 30;
        break;
      case 4:  // right
        this.posX = self.settings.canvasWidth - 30;
        this.posY = self.settings.canvasHeight * Math.random();
        break;
    }
    this.sizeX = 40;
    this.sizeY = 35.25;
    this.width = self.settings.canvasWidth / 30;
    this.height = self.settings.canvasHeight / 20;
    this.frameMax = 3;
    this.spriteDefault = new Sprite(url, this.sizeX, 0, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.sprite = this.spriteDefault;
    this.speed = 1;
    this.updateSprite = function () {
      this.sprite.update();
    }
  }

    function Boss(url) {
        switch (self.getRandom(1, 4)) {
            case 1:  // left
                this.posX = 0;
                this.posY = self.settings.canvasHeight * Math.random();
                break;
            case 2:  // top
                this.posX = Math.random() * self.settings.canvasWidth;
                this.posY = 0;
                break;
            case 3:  // bottom
                this.posX = Math.random() * self.settings.canvasWidth;
                this.posY = self.settings.canvasHeight - 30;
                break;
            case 4:  // right
                this.posX = self.settings.canvasWidth - 30;
                this.posY = self.settings.canvasHeight * Math.random();
                break;
        }
        this.sizeX = 100;
        this.sizeY = 100;
        this.width = self.settings.canvasWidth / 10;
        this.height = self.settings.canvasHeight / 5;
        this.frameMax = 3;
        this.spriteDefault = new Sprite(url, this.sizeX, 0, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
        this.sprite = this.spriteDefault;
        this.speed = 1;
        this.updateSprite = function () {
            this.spriteDefault.update();
        }
    }

  function Hero(url) {
    this.sizeX = 33;
    this.sizeY = 47;
    this.width = self.settings.canvasWidth / 37;
    this.height = self.settings.canvasHeight / 17;
    this.posX = self.settings.canvasWidth / 2 - this.width / 2;
    this.posY = self.settings.canvasHeight / 2 - this.height / 2;
    this.speed = 5;
    this.frameMax = 3;
    this.spriteDefault = new Sprite(url, this.sizeX, 0, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.spriteLeft = new Sprite(url, this.sizeX, this.sizeY, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.spriteRight = new Sprite(url, this.sizeX, this.sizeY * 2, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.spriteUp = new Sprite(url, this.sizeX, this.sizeY * 3, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.sprite = this.spriteDefault;
    this.updateSprite = function () {
      this.sprite.update();
    };
    this.moveLeft = function () {
      this.posX -= this.speed;
    };
    this.moveRight = function () {
      this.posX += this.speed;
    };
    this.moveTop = function () {
      this.posY -= this.speed;
    };
    this.moveBottom = function () {
      this.posY += this.speed;
    }
  }

  function Fireball(url) {
    this.sizeX = 133.8;
    this.sizeY = 134.25;
    this.width = self.settings.canvasWidth / 39;
    this.height = this.width;
    this.startPosX = self.settings.hero.posX;
    this.startPosY = self.settings.hero.posY;
    this.posX = null;
    this.posY = null;
    this.finishPosX = null;
    this.finishPosY = null;
    this.speed = 10;
    this.frameMax = 6;
    this.sprite = new Sprite(url, this.sizeX, 0, this.frameMax, this.sizeX, this.sizeY, this.width, this.height);
    this.updateSprite = function () {
      this.sprite.update();
    }
  }

  function Sprite(url, startX, startY, frameMax, frameWidth, frameHeight, width, height) {
    this.img = new Image();
    this.img.src = url;
    this.startX = startX;
    this.startY = startY;
    this.frameWidth = frameWidth;
    this.frameHeight = frameHeight;
    this.width = width;
    this.height = height;
    this.interval = 0;
    this.frame = 0;
    this.frameMax = frameMax;
    this.update = function () {
      this.interval++;
      if (this.interval % 12 == 0) {
        this.frame++;
        if (this.frame > this.frameMax - 1) {
          this.frame = 0
        }
      }
    }
  }

}
